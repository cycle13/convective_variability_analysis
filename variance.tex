\documentclass[a4paper, 12pt]{article}
\usepackage{natbib}
\usepackage{graphicx}
\graphicspath{{/home/s/S.Rasp/Dropbox/figures/PhD/variance/}}

\title{Convective variability in real mid-latitude weather}

\begin{document}
\maketitle
	
\section{Introduction}

\subsection{Motivation}
% parameterizations explained and problems of deterministic parameterizations
Physical processes which occur on scales smaller than the grid spacing of a numerical model typically have to be parameterized. One such process is convection, which acts to restore stability in the atmosphere and is also the cause of significant amounts of precipitation. Parameterizations represent the effect of these sub-grid scale processes on the resolved scales is represented. Traditionally, this is done in a deterministic way, where the average, most likely, sub-grid effect given a certain large-scale forcing is described. If the sampling size of the unresolved features is large enough, the fluctuations about this mean are indeed small and negligible. So, for example, a grid box of a climate model with several hundreds of kilometers in size contains many convective features, typically 1-10 km in size. Global weather models nowadays, however, have grid spacings on the order of 10 km. Here the sampling size becomes insufficient and the fluctuation about a mean state are significant. Ignoring these fluctuations can lead to systematic biases in the non-linear atmosphere \citep[e.g.][]{Berner2016} and can also lead to an under-representation of extreme events. Furthermore, in an ensemble system, completely deterministic models are severely underdispersive and, therefore, unreliable. 

% Stochastic parameterizations
Stochastic parameterizations aim to solve the problems outlined above. Here, randomness is introduced to represent the variability associated with sub-grid processes. In an ad hoc manner this has been done successfully in medium-range weather prediction for almost two decades \citep{Buizza1999, Berner2009a}. These ad hoc methods, however, are finely tuned to give the appropriate spread-skill relation, and do not actually represent the variability associated with a certain physical process. A more physical way of constructing a stochastic parameterization is to explicitly include a physical model of the uncertainty in the formulation of a parameterization. To get a full representation of the complete model uncertainty this has to be done for every parameterized process individually. One attempt do formulate such a physically-based stochastic parameterization for convection is described now. 

\subsection{The \cite{Craig2006} theory and its application in \cite{Plant2008}} 
% CC06 theory (following Davoudi2010)
The \cite[][CC06]{Craig2006} theory aims to quantify the mass flux fluctuations of a cloud field in convective equilibrium. Convective equilibrium implies that the average properties of the convection are determined by the large-scale forcing. In more detail, the average total mass flux $\langle M \rangle$ is a function of the large-scales. Other assumptions are: (a) the mean mass flux per cloud $\langle m \rangle$ does not depend on the large-scale forcing, only the mean number of clouds $\langle N \rangle$ does; (b) non-interacting clouds: Cloud are spatially separated (no clustering) and do not influence each other. (c) Equal a priori probabilities: This statistical equilibrium assumption implies that ``that clouds are equally likely to occur in any location and with any mass flux''. Using these arguments as a basis, a statistical theory is constructed for the distributions of $N$ and $m$:
\begin{equation} \label{eq:N_dist}
 P(N) = \frac{\langle N \rangle^N}{N!}e^{-\langle N \rangle}
\end{equation}
\begin{equation} \label{eq:m_dist}
 P(m) = \frac{1}{\langle m \rangle}e^{-m/\langle m \rangle}
\end{equation}
Combing these, the distribution of the total mass flux $M$ is given by
\begin{equation} \label{eq:M_dist}
 P(M) = \left( \frac{\langle N \rangle}{\langle m \rangle} \right)^{1/2} e^{-\langle N \rangle} M^{-1/2} e^{-M/\langle m \rangle} I_1\left[ 2 \left( \frac{\langle N \rangle}{\langle m \rangle} M \right)^{1/2} \right],
\end{equation}
where $I_1(x)$is the modified Bessel function of order 1. For large (small) values of $\langle N \rangle$ the shape of this function resembles a Gaussian (Poisson) distribution.   
It is also possible to derive an equation for the normalized variance of $M$:
\begin{equation} \label{eq:M_var}
 \frac{\langle (\delta M)^2 \rangle}{\langle M \rangle^2} = \frac{2}{\langle N \rangle}
\end{equation}
Always note that $\langle M \rangle = \langle N \rangle \langle m \rangle$.

% Numerical experiments in CC06b
The theoretical predictions above were tested against numerical simulations in radiative-convective equilibrium (RCE) by \cite{Cohen2006}. The results of these simulations agreed very well with the theory.

% Usage in PC08
\begin{itemize}
 \item What about other studies eg Davoudi2010
 \item Need to elaborate on how PC08 works
 \item Mention SC15b
\end{itemize}

\subsection{Research questions}
The simple theory of CC06 has been shown to predict the convective variability well in highly idealized simulations and has been used as the basis for the PC08 stochastic convection scheme with some success. There has, however, been no estimate of the convective variability of a ``real'' weather situation. Particularly the mid-latitudes deviate from RCE simulations in many important ways. The goal of this study is to quantitatively investigate the convective variability in ``real'' mid-latitude weather and compare the results to the theoretical predictions of CC06. More specifically, the research question is:

\paragraph{RQ1} How does the convective variability of ``real'' mid-latitude weather situations compare to the predictions of CC06?
\paragraph{Hypothesis} There will be some deviations from the theoretical predictions. 
If this hypothesis is true, a follow up research questions is:
\paragraph{RQ1.1} Which parameters, if any, determine the deviations from the theory?
\paragraph{Hypothesis} Factors which ``make'' the real weather not be in equilibrium determine the deviations.

The hope is that by finding these factors in the second hypothesis, stochastic parameterizations can be constructed which include a better representation of the real variability of convection. 

\section{Methods}

\subsection{General research strategy}
We will use convection-permitting simulations of real weather situations over Germany. A stochastic boundary-layer scheme will be used to create an ensemble where the convection is displaced. We will then use these ensembles to calculate statistics similar to those in CC06 and compare the results to the theoretical prediction. To explain deviations from the theory, we will try to find meaningful measures to characterize the synoptic situation of the case studies and to correlate them with the deviations.  

\subsection{Numerical experiments}
The model used is the COSMO model with 2.8 km horizontal grid spacing $\Delta x$ and operational COSMO-DE settings with one exception, the stochastic boundary-layer scheme which will be described below. The domain size is 357 grid points in either direction with the domain centered at 10E and 50N. For the analysis a 256 by 256 grid point domain (roughly 717km) at the center of the simulation domain is considered. The 50 grid point gap to the boundary ensures that boundary effects are minimal. 

Initial and boundary conditions are taken from the operational COSMO-EU (7km) deterministic forecast with a boundary condition update frequency of 1 h. All runs are started at 00UTC and are run for 24 h. A 20 member ensemble is created by setting a different random number seed in the stochastic boundary-layer scheme for each member. Otherwise, all members are identical, making sure that the large-scale condition are the same and only the convection is shuffled around. 

\subsubsection{The PSPbl boundary-layer scheme}
The physically-based stochastic perturbation boundary-layer scheme (PSPbl) is described and tested in \cite{Kober2016}. A brief outline is given here now. 

\begin{itemize}
 \item a good brief summary of KC16
\end{itemize}

\subsection{Case studies}
The case studies are all from a recent, convectively active period over Central Europe in May/June 2016 with one exception: We also considered 1 July 2009, which is the test case used in \cite{Kober2016}, since this day is a good example of weakly forced diurnal convection.  

\subsection{Analyses}

\subsubsection{Identification of clouds and calculation of cloud statistics}
To identify clouds, first the fields are converted to binary fields by applying a threshold. Two different fields and thresholds are used for this study: (1) Vertical velocity $w >$ 1 m s$^{-1}$ plus a positive cloud water content $q_c >$ 0 kg kg$^{-1}$. The height chosen is 2500 m, which is above the level of shallow convection. The criterion is denoted by the letter $m$ (for mass flux). This criterion was also used by \cite{Cohen2006} and \cite{Davoudi2010}. (2) Instantaneous precipitation rate $pr >$ 0.001 mm h$^{-1}$. This is a surface variable. This criterion is denoted by the letter $p$.

Optionally, ``overlapping'' clouds are identified with the local maximum method, followed by a watershed algorithm to find the extent of each separated cloud. If this step is (not) applied, the label (``nowater'') ``water'' is used. 

For each identified cloud in each ensemble member a cloud size $\sigma_i$ is determined as
\begin{equation} \label{eq:cld_size}
 \sigma_i = n_{px} \Delta x^2,
\end{equation}
where $n_{px}$ is the number of pixels for each cloud $i$. Furthermore, the mass flux per cloud $m_i$ is computed for criterion (1) as
\begin{equation} \label{eq:mass_flux_per_cloud}
 m_i = \Delta x^2 \sum_{px} w \rho,
\end{equation}
where $\rho$ is density. For criterion (2), the precipitation rate per cloud $p_i$ is calculated as
\begin{equation} \label{eq:pr_per_cloud}
 p_i = \sum_{px} pr,
\end{equation}
Statistics of these variables, such as the mean and the distribution are then calculated (see results).

\subsubsection{Calculation of radial distribution functions and clustering parameters}
A radial distribution function (RDF) is calculated at each time for each member separately. To do this, the center of mass for each cloud is identified. For these points a two-dimensional pair correlation is computed, where the step size of the search function is 2$\Delta x$ and the maximum search radius is 30$\Delta x$. The output is normalized, so that a completely randomly distributed field would give an RDF of 1 at all radii. The results are averaged over the ensemble members to give one RDF at each time. 

A clustering radius $r_c$ is defined at the point where the RDF drops below 1 (ignoring the first minimum at small radii if present). 

\subsubsection{Calculation of ensemble means and variances}
For the variance calculations, a coarse-graining is applied with edge lengths of 256, 128, 64, 32, 16, 8 and 4$\Delta x$. No neighborhoods smaller are considered, since these would be significantly below the effective resolution of the model \citep{Bierdel2012}. For each coarse box, the an average value of $m$/$p$ is computed, as well as a total mass flux/precipitation rate $M$/$P$ and the number of clouds $N$ in each box.

To deal with clouds at the boundaries of the coarse-fields, the centers of mass for each cloud is first identified. Then the $m_i$ or $p_i$ is attributed to that one point in space. Therefore, the coarse box which contains the center of mass also contains the entire cloud, while the other box does not contain any of the cloud. 

Finally, the variance $\langle (\delta M \mathrm{or} P)^2 \rangle$ and the ensemble mean $M$/$P$ and $N$ are computed for each box and each coarsening scale, resulting in one two-dimensional field for each coarsening scale. 

\subsubsection{Scatter plots: Comparison with predicted values}
To compare the obtained values to the theoretical predictions, the normalized variance for each coarse box $j$ at each coarsening scale $n$ is calculated as 
\begin{equation} \label{eq:normalized_variance}
 \mu_{2 j, n} = \frac{\langle (\delta M_{j,n} \mathrm{ or } P_{j,n})^2 \rangle}{M_{j,n} \mathrm{ or } P_{j,n}}.
\end{equation}
This normalized variance is then plotted against the mean number of clouds $N{j,n}$. The theory from Eq.\ref{eq:M_var} predicts a slope of 2 for the resulting scatter plot. To get a quantitative comparison of the simulation results and theory, the percent fraction is calculated as
\begin{equation} \label{eq:normalized_variance_percent}
 \frac{\mu_{2 j, n}}{\frac{2}{M_{j,n} \mathrm{ or } P_{j,n}}}\times 100\%.
\end{equation}

\subsubsection{Calculation of the convective adjustment timescale}
The convective timescale was calculated according to \cite{Flack2016}. To produce ensemble mean plots of $\tau_c$ the fields are calculated for each ensemble member individually and then averaged. This leads to some not-smooth regions at the edges. 

\section{Results}

\subsection{Case 1: 2009070100}
\subsubsection{Case description}

\subsection{Cloud statistics}
Fig.\ref{fig:case1_stats} shows histograms of the cloud size $\sigma_i$ and mass flux $m_i$ or precipitation per cloud $p_i$ alongside the radial distribution function for one time step. 

\subsection{Variance fields}
Fig.\ref{fig:case1_var_fields} shows the variance and ensemble mean fields for one time step and one coarsening scale. Blue regions in the bottom left plot indicate less variability compared to theory.

\subsection{Variance scatter plots}
Fig.\ref{fig:case1_var_scatter} summarizes the comparison to theory for each coarsening scale.

\subsection{Convective adjustment time scale}
Fig.\ref{fig:case1_tau_c} shows the ensemble mean $\tau_c$. Since the timescale is not always defined for all members, some discontinuities can occur. 

\subsection{Timeseries plots}
Fig.\ref{fig:case1_timeseries}




\newpage
\bibliographystyle{ametsoc}
{\small
 \bibliography{library}}

\newpage
\section{Figures}

%%%%%%%%%%%%%%%%%%%%%
% CASE 1
%%%%%%%%%%%%%%%%%%%%%

% Cloud statistics
\begin{figure}[ht] \label{fig:case1_stats}
\noindent \centering
2009070100 14UTC m water
\includegraphics[width=\textwidth]{2009070100/m/cloud_stats/stats_00140000.png}\\
2009070100 14UTC m nowater
\includegraphics[width=\textwidth]{2009070100/m_nowater/cloud_stats/stats_00140000.png}\\
2009070100 14UTC p water
\includegraphics[width=\textwidth]{2009070100/p/cloud_stats/stats_00140000.png}\\
2009070100 14UTC p nowater
\includegraphics[width=\textwidth]{2009070100/p_nowater/cloud_stats/stats_00140000.png}\\
\caption{Cloud statistics: The left and middle plots are histograms of cloud size (bins = 15 with bin width = 0.1e8/0.67e8) and $m_i$/$p_i$(bins = 15 with bin width = 0.33e8/0.067). The red line represents the mean value. On the right plot, the RDF is shown. The red line shows the evaluated clustering radius $r_c$.}
\end{figure}

% Variance fields
\begin{figure}[ht] \label{fig:case1_var_fields}
\noindent \centering
2009070100 14UTC m water
\includegraphics[width=\textwidth]{2009070100/m/var/var_00140000_064.png}\\
\caption{Variance fields:  The top left picture shows the vertical velocity field at 2500m height. All blue regions are clouds (given that the cloud water content is positive, not shown). The top right picture shows the ensemble mean total mass flux $M_{j,n}$ for one coarsening scale. The bottom right picture shows the ensemble mean $m_{j,n}$. The bottom right picture shows the Normalized variance divided by the mean cloud number, which the theory predicts to be 2.}
\end{figure}

% Variance scatter
\begin{figure}[ht] \label{fig:case1_var_scatter}
\noindent \centering
2009070100 14UTC m water
\includegraphics[width=\textwidth]{2009070100/m/var_scatter/scatter_00140000.png}\\
\caption{Variance scatter plots: (left) the square root of the normalized variance is plotted against the square root of 1/N. The gray line represents the theoretical prediction. (right) Percentage fraction of theoretical prediction. Crosses represent the mean value for each scale. The mean is calculated in the log-space.}
\end{figure}

% Variance scatter
\begin{figure}[ht] \label{fig:case1_tau_c}
\noindent \centering
2009070100 14UTC m water
\includegraphics[width=\textwidth]{2009070100/m/tauc/tauc_00140000.png}\\
\caption{Ensemble mean convective adjustment timescale}
\end{figure}

% Timeseries
\begin{figure}[ht] \label{fig:case1_timeseries}
\noindent \centering
2009070100 14UTC m water
\includegraphics[width=\textwidth]{2009070100/m/timeseries.png}\\
2009070100 14UTC p water
\includegraphics[width=\textwidth]{2009070100/p/timeseries.png}\\
\caption{Timeseries of several values}
\end{figure}


\end{document}